
<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>–ù–æ–Ω –°—Ç–æ–ø –û—Ç—á–µ—Ç</title>
<style>
    body { font-family: Arial; background-color: #121212; color: #fff; padding: 16px; max-width: 700px; margin: auto; }
    input, select { width: 100%; padding: 8px; margin: 4px 0; border-radius: 5px; border: none; font-size: 16px; }
    button { padding: 10px; border: none; border-radius: 5px; background: #2196f3; color: #fff; font-size: 16px; cursor: pointer; margin-top: 10px; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border-bottom: 1px solid #444; padding: 8px; text-align: left; }
    .summary, .summary2 { background: #1e1e1e; padding: 10px; border-radius: 5px; margin-top: 20px; }
    .filters input, .filters select { width: 48%; display: inline-block; margin-right: 2%; margin-top: 10px; }
    .hidden { display: none; }
  </style>
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log("Service worker registered"));
    }
  </script>
</head>
<body>
  <div id="login" style="text-align:center; padding:50px;">
    <h2>üîê –í—ä–≤–µ–¥–∏ –ø–∞—Ä–æ–ª–∞</h2>
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª–∞" style="padding:10px; width:200px; font-size:18px; border-radius:5px; border:none;">
    <br>
    <button onclick="checkPassword()" style="margin-top:15px; padding:10px 20px; font-size:16px; border:none; border-radius:5px; background:#2196f3; color:white; cursor:pointer;">–í—Ö–æ–¥</button>
  </div>

  <div id="app" style="display:none;">
    <body>
<h2 style="text-align:center;">üìã –ù–æ–Ω –°—Ç–æ–ø –û—Ç—á–µ—Ç</h2>
<!-- –ï–∫—Ä–∞–Ω 1: –í—ä–≤–µ–∂–¥–∞–Ω–µ + –æ–±–æ–±—â–µ–Ω–∏–µ + —Ç–∞–±–ª–∏—Ü–∞ -->
<div id="screen-add">
<label>–î–∞—Ç–∞</label><input id="date" type="date"/>
<label>–¢–∏–ø</label><select id="type"><option>–ü—Ä–∏—Ö–æ–¥</option><option>–†–∞–∑—Ö–æ–¥</option></select>
<label>–ú–µ—Ç–æ–¥</label><select id="method"><option>–ö–µ—à</option><option>–ë–∞–Ω–∫–∞</option></select>
<label>–°—É–º–∞</label><input id="amount" type="number"/>
<label>–ë–µ–ª–µ–∂–∫–∞</label><input id="note" type="text"/>
<button onclick="addRecord()">–î–æ–±–∞–≤–∏ –∑–∞–ø–∏—Å</button>
    <button id="editBtn" onclick="saveEditedRecord()" style="display:none; background:#4caf50;">
  üíæ –ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
</button>

<button onclick="window.print()">üñ®Ô∏è –ü—Ä–∏–Ω—Ç–∏—Ä–∞–π</button>
<button onclick="showScreen('report')">üìä –û—Ç—á–µ—Ç–∏</button>
<div class="summary" id="totalSummary"></div>
<table id="recordsTable">
<thead><tr><th>–î–∞—Ç–∞</th><th>–¢–∏–ø</th><th>–°—É–º–∞</th><th>–ú–µ—Ç–æ–¥</th><th>–ë–µ–ª–µ–∂–∫–∞</th></tr></thead>
<tbody></tbody>
</table>
</div>
<!-- –ï–∫—Ä–∞–Ω 2: –°–∞–º–æ —Ñ–∏–ª—Ç—Ä–∏ –∏ –∞–Ω–∞–ª–∏–∑ -->
<div class="hidden" id="screen-report">
<button onclick="showScreen('add')">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
<div class="filters">
<input id="searchNote" oninput="renderTable()" placeholder="–¢—ä—Ä—Å–∏ –ø–æ –±–µ–ª–µ–∂–∫–∞" type="text"/>
<select id="filterType" onchange="renderTable()">
<option value="">–í—Å–∏—á–∫–∏ —Ç–∏–ø–æ–≤–µ</option>
<option value="–ü—Ä–∏—Ö–æ–¥">–ü—Ä–∏—Ö–æ–¥</option>
<option value="–†–∞–∑—Ö–æ–¥">–†–∞–∑—Ö–æ–¥</option>
</select>
<select id="filterMethod" onchange="renderTable()">
<option value="">–í—Å–∏—á–∫–∏ –º–µ—Ç–æ–¥–∏</option>
<option value="–ö–µ—à">–ö–µ—à</option>
<option value="–ë–∞–Ω–∫–∞">–ë–∞–Ω–∫–∞</option>
</select>
</div>
<div class="summary2" id="daily"></div>
<div class="summary2" id="monthly"></div>
<button onclick="window.print()">üñ®Ô∏è –ü—Ä–∏–Ω—Ç–∏—Ä–∞–π</button>
<button onclick="clearRecords()">üóëÔ∏è –ò–∑—á–∏—Å—Ç–∏ –≤—Å–∏—á–∫–∏</button>
</div>
<script>
let records = [];

function showScreen(name) {
  document.getElementById("screen-add").classList.toggle("hidden", name !== "add");
  document.getElementById("screen-report").classList.toggle("hidden", name !== "report");
  if (name === "report") renderTable();
  if (name === "add") renderMainTable();
}

function saveToLocal() {
  localStorage.setItem("nonstop_records", JSON.stringify(records));
}

function loadFromLocal() {
  const saved = localStorage.getItem("nonstop_records");
  if (saved) records = JSON.parse(saved);
}

function addRecord() {
  const date = document.getElementById("date").value;
  const type = document.getElementById("type").value;
  const method = document.getElementById("method").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const note = document.getElementById("note").value;
  if (!date || isNaN(amount)) return alert("–ú–æ–ª—è –≤—ä–≤–µ–¥–∏ –¥–∞—Ç–∞ –∏ —Å—É–º–∞");
  records.push({ date, type, method, amount, note });
  saveToLocal();
  renderMainTable();
  clearForm();
}

function clearForm() {
  document.getElementById("date").value = "";
  document.getElementById("amount").value = "";
  document.getElementById("note").value = "";
}

function clearRecords() {
  if (confirm("–°–∏–≥—É—Ä–µ–Ω –ª–∏ —Å–∏, —á–µ –∏—Å–∫–∞—à –¥–∞ –∏–∑—Ç—Ä–∏–µ—à –≤—Å–∏—á–∫–∏ –∑–∞–ø–∏—Å–∏?")) {
    records = [];
    saveToLocal();
    renderMainTable();
  }
}

function renderMainTable() {
  const tbody = document.querySelector("#recordsTable tbody");
  tbody.innerHTML = "";
  let income = 0, expense = 0, cashIn = 0, cashOut = 0, bankIn = 0, bankOut = 0;

  records.forEach(r => {
    const row =const row = `<tr>
  <td>${r.date}</td>
  <td>${r.type}</td>
  <td>${r.amount.toFixed(2)} –ª–≤</td>
  <td>${r.method}</td>
  <td>${r.note}</td>
  <td><button onclick="editRecord(${i})">‚úèÔ∏è</button></td>
  <button id="editBtn" onclick="saveEditedRecord()" style="display:none; background:#4caf50;">
  üíæ –ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
</button>

</tr>`;

    tbody.innerHTML += row;

    if (r.type === "–ü—Ä–∏—Ö–æ–¥") income += r.amount;
    if (r.type === "–†–∞–∑—Ö–æ–¥") expense += r.amount;

    if (r.method === "–ö–µ—à" && r.type === "–ü—Ä–∏—Ö–æ–¥") cashIn += r.amount;
    if (r.method === "–ö–µ—à" && r.type === "–†–∞–∑—Ö–æ–¥") cashOut += r.amount;
    if (r.method === "–ë–∞–Ω–∫–∞" && r.type === "–ü—Ä–∏—Ö–æ–¥") bankIn += r.amount;
    if (r.method === "–ë–∞–Ω–∫–∞" && r.type === "–†–∞–∑—Ö–æ–¥") bankOut += r.amount;
  });

  const balance = income - expense;
  const cashBalance = cashIn - cashOut;
  const bankBalance = bankIn - bankOut;

  document.getElementById("totalSummary").innerHTML = `
    <strong>–û–±—â–æ –ø—Ä–∏—Ö–æ–¥–∏:</strong> ${income.toFixed(2)} –ª–≤ |
    <strong>–û–±—â–æ —Ä–∞–∑—Ö–æ–¥–∏:</strong> ${expense.toFixed(2)} –ª–≤ |
    <strong>–ë–∞–ª–∞–Ω—Å:</strong> ${balance.toFixed(2)} –ª–≤<br>
    üíµ –ö–µ—à: ${cashBalance.toFixed(2)} –ª–≤ | üè¶ –ë–∞–Ω–∫–∞: ${bankBalance.toFixed(2)} –ª–≤`;
}

function renderTable() {
  const filterType = document.getElementById("filterType").value;
  const filterMethod = document.getElementById("filterMethod").value;
  const searchNote = document.getElementById("searchNote").value.toLowerCase();

  let todayIncome = 0, monthIncome = 0, todayExpense = 0, monthExpense = 0;
  const today = new Date().toISOString().slice(0,10);
  const month = today.slice(0,7);

  const filtered = records.filter(r =>
    (!filterType || r.type === filterType) &&
    (!filterMethod || r.method === filterMethod) &&
    (!searchNote || r.note.toLowerCase().includes(searchNote))
  );

  filtered.forEach(r => {
    if (r.date === today && r.type === "–ü—Ä–∏—Ö–æ–¥") todayIncome += r.amount;
    if (r.date === today && r.type === "–†–∞–∑—Ö–æ–¥") todayExpense += r.amount;
    if (r.date.startsWith(month) && r.type === "–ü—Ä–∏—Ö–æ–¥") monthIncome += r.amount;
    if (r.date.startsWith(month) && r.type === "–†–∞–∑—Ö–æ–¥") monthExpense += r.amount;
  });

  document.getElementById("daily").innerHTML = `üìÖ <strong>–î–Ω–µ—Å:</strong> –ü—Ä–∏—Ö–æ–¥–∏: ${todayIncome.toFixed(2)} –ª–≤ | –†–∞–∑—Ö–æ–¥–∏: ${todayExpense.toFixed(2)} –ª–≤`;
  document.getElementById("monthly").innerHTML = `üìÜ <strong>–ú–µ—Å–µ—Ü:</strong> –ü—Ä–∏—Ö–æ–¥–∏: ${monthIncome.toFixed(2)} –ª–≤ | –†–∞–∑—Ö–æ–¥–∏: ${monthExpense.toFixed(2)} –ª–≤`;
}

loadFromLocal();
renderMainTable();
</script>
</body>
  </div>

<script>
function checkPassword() {
  const pass = document.getElementById("password").value;
  if (pass === "7801") {
    document.getElementById("login").style.display = "none";
    document.getElementById("app").style.display = "block";
  } else {
    alert("–ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞!");
  }
}let editIndex = -1;

function editRecord(i) {
  const r = records[i];
  document.getElementById("date").value = r.date;
  document.getElementById("type").value = r.type;
  document.getElementById("method").value = r.method;
  document.getElementById("amount").value = r.amount;
  document.getElementById("note").value = r.note;
  editIndex = i;
  document.getElementById("editBtn").style.display = "block";
}

function saveEditedRecord() {
  if (editIndex === -1) return;
  const date = document.getElementById("date").value;
  const type = document.getElementById("type").value;
  const method = document.getElementById("method").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const note = document.getElementById("note").value;
  if (!date || isNaN(amount)) return alert("–ú–æ–ª—è –≤—ä–≤–µ–¥–∏ –¥–∞—Ç–∞ –∏ —Å—É–º–∞");
  records[editIndex] = { date, type, method, amount, note };
  saveToLocal();
  renderMainTable();
  clearForm();
  editIndex = -1;
  document.getElementById("editBtn").style.display = "none";
}

</script>
</body>
</html>
